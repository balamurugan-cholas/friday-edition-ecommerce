{% extends "base.html" %}
{% block content %}

<!-- Product Details Section -->
<section class="product-page py-4">
  <div class="container-fluid">

    <!-- Mobile Search (only visible on mobile) -->
    <div style="margin-top: -10%;" class="mobile-search d-block d-lg-none p-3 position-relative">
      <form class="d-flex position-relative">
        <input class="form-control" type="search" placeholder="Search products">
        <span class="search-icon"><i class="bi bi-search"></i></span>
      </form>
    </div>

    <!-- Mobile Dropdown Links -->
    <div class="d-lg-none text-center mt-2 mb-3">
      <div class="d-inline-flex gap-3">
        <!-- Product Categories Dropdown -->
        <div class="dropdown">
          <button class="btn btn-outline-dark dropdown-toggle" type="button" id="mobileProductDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Products
          </button>
          <ul class="dropdown-menu text-center" aria-labelledby="mobileProductDropdown">
            {% set categories = ['electronics', 'dress', 'mobile', 'sports', 'beauty', 'toys'] %}
            {% for category in categories %}
              <a class="dropdown-item" href="{{ url_for('shop.category_page', category_name=category) }}">
                {{ category.title() if category != 'dress' else 'Fashion' }}
              </a>
            {% endfor %}
          </ul>
        </div>

        <!-- Shops Dropdown -->
        <div class="dropdown">
          <button class="btn btn-outline-dark dropdown-toggle" type="button" id="mobileShopDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Shop
          </button>
          <ul class="dropdown-menu text-center" aria-labelledby="mobileShopDropdown">
            {% for s in all_shops %}
            <li>
              <a class="dropdown-item" href="{{ url_for('shop.shop_page', shop_name=s) }}">
                {{ s }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="row g-4">

      <!-- Left: Product Image -->
      <div class="col-lg-6">
        <div class="product-image">
          <img src="{{ url_for('static', filename='images/' + product.image) }}" 
               class="img-fluid w-100" 
               alt="{{ product.name }}">
        </div>
      </div>

      <!-- Right: Product Info -->
      <div class="col-lg-6 d-flex flex-column justify-content-center">
        <h1 class="fw-bold">{{ product.name }}</h1>
        <p class="text-muted product-price mb-2">${{ product.price }}</p>
        <p class="product-description mb-3">{{ product.description }}</p>
        <p class="store-name product-price mb-2">
          Store: 
          <a style="text-decoration: none;" href="{{ url_for('shop.shop_page', shop_name=product.store) }}" class="text-primary">
            {{ product.store }}
          </a>
        </p>

        <!-- Add to Cart Form (no AJAX) -->
        <form action="{{ url_for('shop.add_to_cart', product_id=product.id) }}"
              method="POST"
              class="product-form d-flex flex-column gap-2"
              data-product-id="{{ product.id }}">

          <!-- Quantity Input -->
          <div class="align-left">
            <label for="quantity" class="fw-bold">Quantity:</label>
            <input type="number" id="quantity" name="quantity"
                   value="1" min="1"
                   class="custom-input">
          </div>

          <!-- Size Selection -->
          {% if product.category == 'dress' %}
          <div class="align-left mt-2">
            <label for="size" class="fw-bold">Size:</label>
            <select name="size" id="size" class="custom-select">
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="XXL">XXL</option>
            </select>
          </div>
          {% elif product.category in ['sneakers', 'shoes', 'slippers'] %}
          <div class="align-left mt-2">
            <label for="size" class="fw-bold">Size:</label>
            <select name="size" id="size" class="custom-select">
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
          {% endif %}

          <!-- Buttons -->
          <div class="button-group mt-3">
            <button type="submit" class="btn btn-warning btn-lg w-100 mb-2 add-to-cart">Add to Cart</button>
            <a href="#" class="btn btn-success btn-lg w-100">Buy Now</a>
          </div>
        </form>
      </div>
    </div>

    <!-- Related Products Carousel -->
    {% if related_products %}
    <div class="related-products mt-5">
      <h4 class="mb-3">Related Products</h4>
      <hr>
      <div class="d-flex overflow-auto gap-3">
        {% for item in related_products %}
        <div class="card product-card text-center" style="min-width: 180px;">
          <img src="{{ url_for('static', filename='images/' + item.image) }}" 
               class="card-img-top" 
               alt="{{ item.name }}">
          <div class="card-body d-flex flex-column">
            <h6 class="card-title flex-grow-1">{{ item.name }}</h6>
            <p class="card-text mb-2">${{ item.price }}</p>
            <p class="card-text mb-2">From : {{ item.store }}</p>
            <a style="color: black;" href="{{ url_for('shop.product_page', product_id=item.id) }}" 
               class="btn btn-sm btn-outline-warning btn-warning mt-auto">View</a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- More From This Store -->
    {% if store_products %}
    <div class="store-products mt-5">
      <h4 class="mb-3">More From This Store</h4>
      <hr>
      <div class="row g-3">
        {% for item in store_products %}
        <div class="col-6 col-md-3">
          <div class="card product-card text-center">
            <img src="{{ url_for('static', filename='images/' + item.image) }}" 
                 class="card-img-top" 
                 alt="{{ item.name }}">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title flex-grow-1">{{ item.name }}</h6>
              <p class="card-text mb-2">${{ item.price }}</p>
              <p class="card-text mb-2">From : {{ item.store }}</p>
              <a style="color: black;" href="{{ url_for('shop.product_page', product_id=item.id) }}" 
                 class="btn btn-sm btn-outline-warning btn-warning mt-auto">View</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  </div>
</section>

{% endblock %}
