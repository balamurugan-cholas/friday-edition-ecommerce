{% extends "base.html" %}
{% block content %}
<div class="container py-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">Welcome, {{ partner_name }}</h2>
            <p class="text-muted mb-0">Manage your products</p>
        </div>
        <a href="{{ url_for('shop.partner_logout') }}" class="btn btn-outline-danger">Logout</a>
    </div>

    <!-- Filter & Add Button -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <input type="text" id="productSearch" class="form-control w-50 me-3"
               placeholder="ðŸ”Ž Quick Search Products...">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
            <i class="bi bi-plus-circle me-1"></i> Add Product
        </button>
    </div>

    <!-- Products Grid -->
    {% if products %}
        <div class="row" id="productGrid">
            {% for product in products %}
                <div class="col-md-3 mb-4 product-card">
                    <div class="card h-100 shadow-sm">
                        <img src="{{ url_for('static', filename='images/' ~ product['image']) }}"
                             class="card-img-top" style="height:180px; object-fit:cover;" alt="{{ product['name'] }}">
                        <div class="card-body d-flex flex-column p-3">
                            <h6 class="card-title fw-bold mb-1">{{ product['name'] }}</h6>
                            <p class="card-text mb-1"><strong>${{ product['price'] }}</strong></p>
                            <p class="card-text text-muted mb-3">{{ product['category']|capitalize }}</p>
                            <div class="mt-auto d-flex justify-content-between">
                                <a href="{{ url_for('shop.product_page', product_id=product['id']) }}"
                                   class="btn btn-sm btn-outline-primary">View</a>
                                <button class="btn btn-sm btn-outline-secondary edit-btn"
                                        data-bs-toggle="modal"
                                        data-bs-target="#editProductModal"
                                        data-id="{{ product['id'] }}"
                                        data-name="{{ product['name'] }}"
                                        data-price="{{ product['price'] }}"
                                        data-category="{{ product['category'] }}"
                                        data-description="{{ product['description'] }}">
                                    Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-btn"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteProductModal"
                                        data-id="{{ product['id'] }}"
                                        data-name="{{ product['name'] }}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No products found yet. Start by adding a product!</p>
    {% endif %}
</div>

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content shadow">
            <div class="modal-header">
                <h5 class="modal-title">Add New Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('shop.add_product') }}" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Product Name</label>
                            <input type="text" name="name" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Price</label>
                            <input type="number" step="0.01" name="price" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select name="category" class="form-select" required>
                                <option value="">Select Category</option>
                                <option value="electronics">Electronics</option>
                                <option value="dress">Dress</option>
                                <option value="mobile">Mobile</option>
                                <option value="sneakers">Sports</option>
                                <option value="beauty">Beauty</option>
                                <option value="toys">Toys</option>
                            </select>                            
                        </div>
                        <div class="col-12">
                            <label class="form-label">Description</label>
                            <textarea name="description" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Product Image</label>
                            <input type="file" name="image" class="form-control" accept="image/*" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Upload Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Edit Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="editProductForm" method="POST" action="" enctype="multipart/form-data">
        <div class="modal-body">
          <input type="hidden" name="id" id="edit-id">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Product Name</label>
              <input type="text" name="name" id="edit-name" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Price</label>
              <input type="number" step="0.01" name="price" id="edit-price" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Category</label>
              <select name="category" id="edit-category" class="form-select" required>
                <option value="electronics">Electronics</option>
                <option value="dress">Dress</option>
                <option value="mobile">Mobile</option>
                <option value="sneakers">Sports</option>
                <option value="beauty">Beauty</option>
                <option value="toys">Toys</option>
            </select>            
            </div>
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea name="description" id="edit-description" class="form-control" rows="3"></textarea>
            </div>
            <div class="col-12">
              <label class="form-label">Update Image (optional)</label>
              <input type="file" name="image" class="form-control" accept="image/*">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Delete Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="deleteProductForm" method="POST" action="">
        <div class="modal-body">
          <p>Are you sure you want to delete <strong id="delete-product-name"></strong>?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Edit Modal Fill
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.getElementById('edit-id').value = btn.dataset.id;
            document.getElementById('edit-name').value = btn.dataset.name;
            document.getElementById('edit-price').value = btn.dataset.price;
            document.getElementById('edit-category').value = btn.dataset.category;
            document.getElementById('edit-description').value = btn.dataset.description;
            document.getElementById('editProductForm').action = `/product/${btn.dataset.id}/edit`;
        });
    });
    // Delete Modal Fill
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.getElementById('delete-product-name').textContent = btn.dataset.name;
            document.getElementById('deleteProductForm').action = `/product/${btn.dataset.id}/delete`;
        });
    });
    // Live Search
    const searchInput = document.getElementById('productSearch');
    searchInput.addEventListener('keyup', () => {
        const query = searchInput.value.toLowerCase();
        document.querySelectorAll('.product-card').forEach(card => {
            const name = card.querySelector('.card-title').textContent.toLowerCase();
            card.style.display = name.includes(query) ? '' : 'none';
        });
    });
});
</script>
{% endblock %}
